[{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Label":"VBR - Credential Check","Name":"VBR-CredentialCheck","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"CustomDataTypeProperties":{"CatalogMoid":"shared","ObjectType":"workflow.CustomDataProperty"},"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The PowerShell endpoint on which the script is to be executed. PowerShell Remoting must be enabled on the endpoint to allow for scripts to be executed remotely.\n","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"Dropdown"},"Label":"External Target","Name":"Target","ObjectType":"workflow.TargetDataType","Properties":[{"DisplayAttributes":["Name","TargetType"],"ObjectType":"workflow.TargetProperty","Selector":"/api/v1/asset/Targets?$filter=(TargetType eq PowerShellEndpoint and Status eq Connected)","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"SupportedObjects":["asset.Target"]}],"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"User Credential Description","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"User Description","Name":"userdescription","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Administrative User","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"User Name","Name":"username","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Admin password","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Password","Name":"userpassword","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true}],"ObjectType":"workflow.Properties","OutputDefinition":[],"RetryDelay":60,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":60,"TimeoutPolicy":"Timeout"},"RollbackTasks":[],"SharedScope":"user","Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Label":"VBR Add Managed Server","Name":"VBRAddManagedServer","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"CustomDataTypeProperties":{"CatalogMoid":"shared","ObjectType":"workflow.CustomDataProperty"},"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The PowerShell endpoint on which the script is to be executed. PowerShell Remoting must be enabled on the endpoint to allow for scripts to be executed remotely.\n","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"Dropdown"},"Label":"External Target","Name":"Target","ObjectType":"workflow.TargetDataType","Properties":[{"DisplayAttributes":["Name","TargetType"],"ObjectType":"workflow.TargetProperty","Selector":"/api/v1/asset/Targets?$filter=(TargetType eq PowerShellEndpoint and Status eq Connected)","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"SupportedObjects":["asset.Target"]}],"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Veeam-managed server to add","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Server Name","Name":"servername","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Host Platform","Name":"hostplatform","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[{"Label":"Windows","ObjectType":"workflow.EnumEntry","Value":"0"},{"Label":"Linux","ObjectType":"workflow.EnumEntry","Value":"1"}],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"enum"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"User Name","Name":"username","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Credential Description","Name":"credentialdesc","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true}],"ObjectType":"workflow.Properties","OutputDefinition":[],"RetryDelay":60,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":300,"TimeoutPolicy":"Timeout"},"RollbackTasks":[],"SharedScope":"user","Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Label":"VBR - Add Proxy","Name":"VBR-AddProxy","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"CustomDataTypeProperties":{"CatalogMoid":"shared","ObjectType":"workflow.CustomDataProperty"},"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The PowerShell endpoint on which the script is to be executed. PowerShell Remoting must be enabled on the endpoint to allow for scripts to be executed remotely.\n","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"Dropdown"},"Label":"External Target","Name":"Target","ObjectType":"workflow.TargetDataType","Properties":[{"DisplayAttributes":["Name","TargetType"],"ObjectType":"workflow.TargetProperty","Selector":"/api/v1/asset/Targets?$filter=(TargetType eq PowerShellEndpoint and Status eq Connected)","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"SupportedObjects":["asset.Target"]}],"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Veeam-managed server to add","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Server Name","Name":"servername","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Proxy Type","Name":"proxytype","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[{"Label":"VMware","ObjectType":"workflow.EnumEntry","Value":"0"},{"Label":"Hyper-V","ObjectType":"workflow.EnumEntry","Value":"1"},{"Label":"NAS Filer","ObjectType":"workflow.EnumEntry","Value":"2"},{"Label":"CDP","ObjectType":"workflow.EnumEntry","Value":"3"},{"Label":"Linux","ObjectType":"workflow.EnumEntry","Value":"4"},{"Label":"Computer File Server","ObjectType":"workflow.EnumEntry","Value":"5"}],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"enum"},"Required":true}],"ObjectType":"workflow.Properties","OutputDefinition":[],"RetryDelay":60,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":300,"TimeoutPolicy":"Timeout"},"RollbackTasks":[],"SharedScope":"user","Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"ClassId":"workflow.WorkflowDefinition","DefaultVersion":true,"InputDefinition":[{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"User Credential Description","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"User Description","Name":"userdescription","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Administrative User","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"User Name","Name":"username","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Admin password","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Password","Name":"userpassword","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Host Platform","Name":"hostplatform","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[{"Label":"Windows","ObjectType":"workflow.EnumEntry","Value":"0"},{"Label":"Linux","ObjectType":"workflow.EnumEntry","Value":"1"}],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"enum"},"Required":true},{"CustomDataTypeProperties":{"CatalogMoid":"shared","ObjectType":"workflow.CustomDataProperty"},"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The PowerShell endpoint on which the script is to be executed. PowerShell Remoting must be enabled on the endpoint to allow for scripts to be executed remotely.\n","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"Dropdown"},"Label":"External Target","Name":"Target","ObjectType":"workflow.TargetDataType","Properties":[{"DisplayAttributes":["Name","TargetType"],"ObjectType":"workflow.TargetProperty","Selector":"/api/v1/asset/Targets?$filter=(TargetType eq PowerShellEndpoint and Status eq Connected)","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"SupportedObjects":["asset.Target"]}],"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Veeam-managed server to add","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Server Name","Name":"servername","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Proxy Type","Name":"proxytype","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[{"Label":"VMware","ObjectType":"workflow.EnumEntry","Value":"0"},{"Label":"Hyper-V","ObjectType":"workflow.EnumEntry","Value":"1"},{"Label":"NAS Filer","ObjectType":"workflow.EnumEntry","Value":"2"},{"Label":"CDP","ObjectType":"workflow.EnumEntry","Value":"3"},{"Label":"Linux","ObjectType":"workflow.EnumEntry","Value":"4"},{"Label":"Computer File Server","ObjectType":"workflow.EnumEntry","Value":"5"}],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"enum"},"Required":true}],"InputParameterSet":[],"Label":"VBR Proxy","Name":"VBRInfra","ObjectType":"workflow.WorkflowDefinition","OutputDefinition":[],"Properties":{"ExternalMeta":true,"ObjectType":"workflow.WorkflowProperties","SupportStatus":"Supported"},"SharedScope":"user","Tasks":[{"Name":"StartTask","NextTask":"VBRCredentialCheck1","ObjectType":"workflow.StartTask"},{"Name":"SuccessEndTask","ObjectType":"workflow.SuccessEndTask"},{"Name":"FailureEndTask","ObjectType":"workflow.FailureEndTask"},{"CatalogMoid":"user","InputParameters":{"Target":"${workflow.input.Target}","userdescription":"${workflow.input.userdescription}","username":"${workflow.input.username}","userpassword":"${workflow.input.userpassword}"},"Label":"VBR - Credential Check","Name":"VBRCredentialCheck1","ObjectType":"workflow.WorkerTask","OnSuccess":"VBRAddManagedServer1","TaskDefinitionName":"VBR-CredentialCheck","Version":1},{"CatalogMoid":"user","InputParameters":{"Target":"${workflow.input.Target}","credentialdesc":"${workflow.input.userdescription}","hostplatform":"${workflow.input.hostplatform}","servername":"${workflow.input.servername}","username":"${workflow.input.username}"},"Label":"VBR Add Managed Server","Name":"VBRAddManagedServer1","ObjectType":"workflow.WorkerTask","OnSuccess":"VBRAddProxy1","TaskDefinitionName":"VBRAddManagedServer","Version":1},{"CatalogMoid":"user","InputParameters":{"Target":"${workflow.input.Target}","proxytype":"${workflow.input.proxytype}","servername":"${workflow.input.servername}"},"Label":"VBR - Add Proxy","Name":"VBRAddProxy1","ObjectType":"workflow.WorkerTask","OnSuccess":"SuccessEndTask","TaskDefinitionName":"VBR-AddProxy","Version":1}],"UiInputFilters":[],"UiRenderingData":{"Positions":[{"Name":"StartTask","X":10,"Y":18},{"Name":"SuccessEndTask","X":12,"Y":458},{"Name":"FailureEndTask","X":621.9605816608581,"Y":179},{"Name":"VBRCredentialCheck1","X":149.5,"Y":69},{"Name":"VBRAddManagedServer1","X":96.5,"Y":126},{"Name":"VBRAddProxy1","X":85.5,"Y":222}]},"VariableDefinition":[{"CustomDataTypeProperties":{"ObjectType":"workflow.CustomDataProperty"},"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The PowerShell endpoint on which the script is to be executed. PowerShell Remoting must be enabled on the endpoint to allow for scripts to be executed remotely.\n","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"Dropdown"},"Label":"Target","Name":"Target","ObjectType":"workflow.TargetDataType","Properties":[{"DisplayAttributes":["Name","TargetType"],"ObjectType":"workflow.TargetProperty","Selector":"/api/v1/asset/Targets?$filter=(TargetType eq PowerShellEndpoint and Status eq Connected)","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"SupportedObjects":["asset.Target"]}],"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Veeam-managed server to add","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"servername","Name":"servername","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"proxytype","Name":"proxytype","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[{"Label":"VMware","ObjectType":"workflow.EnumEntry","Value":"0"},{"Label":"Hyper-V","ObjectType":"workflow.EnumEntry","Value":"1"},{"Label":"NAS Filer","ObjectType":"workflow.EnumEntry","Value":"2"},{"Label":"CDP","ObjectType":"workflow.EnumEntry","Value":"3"},{"Label":"Linux","ObjectType":"workflow.EnumEntry","Value":"4"},{"Label":"Computer File Server","ObjectType":"workflow.EnumEntry","Value":"5"}],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"enum"},"Required":true}],"Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/WorkflowDefinitions","Verb":"POST"},{"Body":{"Batch":[{"Body":"$gitScript = \"https://raw.githubusercontent.com/ronnm-veeam/cisco-intersight/main/BR-IntersightCredentialCheck.ps1\"\r\n\r\n$pathElements = \"$gitScript\" -split '/'\r\n$scriptName = $pathElements[$PathElements.Length-1]\r\n\r\nInvoke-WebRequest -Uri $gitScript -OutFile \"$env:TEMP\\$scriptName\"\r\n\r\n$script = \"$env:TEMP\\$scriptName\"\r\n& $script {{.global.task.input.username}} {{.global.task.input.userpassword}} \"{{.global.task.input.userdescription}}\"\r\n#Start-Process 'msiexec.exe' -ArgumentList $SQL2014_CLR_Arguments -Wait -NoNewWindow\r\n#try {\r\n#    $cred = Get-VBRCredentials | Where-Object {$_.Description -eq \"{{.global.task.input.userdescription}}\"}\r\n#    if ($cred -EQ $null) {\r\n#        $cred = Add-VBRCredentials -User {{.global.task.input.username}} -Password \"{{.global.task.input.userpassword}}\" -Description \"{{.global.task.input.userdescription}}\"\r\n#        if ($cred -EQ $null) { exit 1 }\r\n#        }\r\n#    exit 0\r\n#}\r\n#catch { exit 1 }","ContentType":"json","Description":"Check for existence of credential.  If does not exist then add","Label":"VBR - Credential Check","Name":"InvokePowerShellScript1","ObjectType":"workflow.PowerShellApi","Outcomes":[],"PowerShellResponseSpec":{"Parameters":[]}}],"ClassId":"workflow.PowerShellBatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Name":"VBR - Credential Check","ObjectType":"workflow.PowerShellBatchApiExecutor","Output":{},"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"VBR-CredentialCheck\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/PowerShellBatchApiExecutors","Verb":"POST"},{"Body":{"Batch":[{"Body":"$gitScript = \"https://raw.githubusercontent.com/ronnm-veeam/cisco-intersight/main/BR-IntersightAddManagedServer.ps1\"\r\n\r\n$pathElements = \"$gitScript\" -split '/'\r\n$scriptName = $pathElements[$PathElements.Length-1]\r\n\r\nInvoke-WebRequest -Uri $gitScript -OutFile \"$env:TEMP\\$scriptName\"\r\n\r\n$script = \"$env:TEMP\\$scriptName\"\r\n& $script {{.global.task.input.servername}} {{.global.task.input.hostplatform}} {{.global.task.input.username}}  \"{{.global.task.input.credentialdesc}}\"\r\n\r\n#$managedServer = Get-VBRServer -Name {{.global.task.input.servername}}\r\n#if ($managedServer -EQ $null) {\r\n#    $cred = Get-VBRCredentials | Where-Object {$_.Description -eq \"{{.global.task.input.credentialdesc}}\"}\r\n#    if ({{.global.task.input.hostplatform}} -eq 0) {\r\n#        Write-Host \"Adding windows host\"\r\n#        Add-VBRWinServer -Name {{.global.task.input.servername}} -Credentials $cred\r\n#    }\r\n#    else {\r\n#        Write-Host \"Adding linux host\"\r\n#        Add-VBRLinux -Name {{.global.task.input.servername}} -Credentials $cred\r\n#    }   \r\n#    exit 0\r\n#}\r\n#else {\r\n#    Write-Host \"Managed server already exists\"\r\n#    exit 0\r\n#}","ContentType":"json","Description":"VBR add managed host","Label":"VBR Add Managed Server","Name":"InvokePowerShellScript1","ObjectType":"workflow.PowerShellApi","OperationTimeout":"300","Outcomes":[],"PowerShellResponseSpec":{"Parameters":[]}}],"ClassId":"workflow.PowerShellBatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Name":"VBR Add Managed Server","ObjectType":"workflow.PowerShellBatchApiExecutor","Output":{},"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"VBRAddManagedServer\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/PowerShellBatchApiExecutors","Verb":"POST"},{"Body":{"Batch":[{"Body":"$gitScript = \"https://raw.githubusercontent.com/ronnm-veeam/cisco-intersight/main/BR-IntersightAddProxy.ps1\"\r\n\r\n$pathElements = \"$gitScript\" -split '/'\r\n$scriptName = $pathElements[$PathElements.Length-1]\r\n\r\nInvoke-WebRequest -Uri $gitScript -OutFile \"$env:TEMP\\$scriptName\"\r\n\r\n$script = \"$env:TEMP\\$scriptName\"\r\n& $script {{.global.task.input.servername}} {{.global.task.input.proxytype}}\r\n\r\n\r\n\r\n#$managedServer = Get-VBRServer -Name {{.global.task.input.servername}}\r\n#if ($managedServer -NE $null) {\r\n#    if ({{.global.task.input.proxytype}} -eq 0) {\r\n#        Write-Host \"Adding VMWare proxy\"\r\n#        Add-VBRViProxy -Server $managedServer\r\n#    }\r\n#    else {\r\n#        Write-Host \"Proxy type not supported!\"\r\n#        exit 1\r\n#    }\r\n#    exit 0\r\n#}\r\n#else {\r\n#    exit 0\r\n#}","ContentType":"json","Description":"Add VBR proxy","Label":"Add VBR Proxy","Name":"InvokePowerShellScript1","ObjectType":"workflow.PowerShellApi","OperationTimeout":"300","Outcomes":[],"PowerShellResponseSpec":{"Parameters":[]}}],"ClassId":"workflow.PowerShellBatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Name":"VBR - Add Proxy","ObjectType":"workflow.PowerShellBatchApiExecutor","Output":{},"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"VBR-AddProxy\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/PowerShellBatchApiExecutors","Verb":"POST"}]