[{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Label":"VBR - Add Proxy v1.0","Name":"VBR-AddProxyv1.0","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"CustomDataTypeProperties":{"CatalogMoid":"shared","ObjectType":"workflow.CustomDataProperty"},"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The PowerShell endpoint on which the script is to be executed. PowerShell Remoting must be enabled on the endpoint to allow for scripts to be executed remotely.\n","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"Dropdown"},"Label":"External Target","Name":"Target","ObjectType":"workflow.TargetDataType","Properties":[{"DisplayAttributes":["Name","TargetType"],"ObjectType":"workflow.TargetProperty","Selector":"/api/v1/asset/Targets?$filter=(TargetType eq PowerShellEndpoint and Status eq Connected)","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"SupportedObjects":["asset.Target"]}],"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Veeam-managed server to add","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Server Name","Name":"servername","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Proxy Type","Name":"proxytype","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[{"Label":"VMware","ObjectType":"workflow.EnumEntry","Value":"0"},{"Label":"Hyper-V","ObjectType":"workflow.EnumEntry","Value":"1"},{"Label":"NAS Filer","ObjectType":"workflow.EnumEntry","Value":"2"},{"Label":"CDP","ObjectType":"workflow.EnumEntry","Value":"3"},{"Label":"Linux","ObjectType":"workflow.EnumEntry","Value":"4"},{"Label":"Computer File Server","ObjectType":"workflow.EnumEntry","Value":"5"}],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"enum"},"Required":true}],"ObjectType":"workflow.Properties","OutputDefinition":[],"RetryDelay":60,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":300,"TimeoutPolicy":"Timeout"},"RollbackTasks":[],"SharedScope":"user","Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"Batch":[{"Body":"#\r\n# Add a new proxy from an existing managed server to VBR.  If the managed server does not\r\n# already exist an error is returned otherwise the managed server is assigned the specified\r\n# proxy type role assuming it is appropriate to the platform (i.e. no Linux support for \r\n# Hyper-V proxy).\r\n#\r\n# Inputs: workflow inputs with references \"servername\" and \"proxytype\" (0 - VMware/Windows,\r\n# 1 - VMware/Linux, 2 - HyperV, 3 - NAS, 4 - CDP, 5 - Computer)\r\ntry {\r\n    $managedServer = Get-VBRServer -Name {{.global.task.input.servername}}\r\n    if ($managedServer -NE $null) {\r\n        Switch ({{.global.task.input.proxytype}}) {\r\n            0   {\r\n                Write-Host \"Adding Windows VMWare proxy\"\r\n                Add-VBRViProxy -Server {{.global.task.input.servername}}\r\n                }\r\n            1   {\r\n                Write-Host \"Adding Linux VMWare proxy\"\r\n                Add-VBRViLinuxProxy -Server {{.global.task.input.servername}}\r\n                }\r\n            2   {\r\n                Write-Host \"Adding HyperV proxy\"\r\n                Add-VBRHvProxy -Server {{.global.task.input.servername}}\r\n                }\r\n            3   {\r\n                Write-Host \"Adding NAS proxy\"\r\n                Add-VBRNASProxyServer -Server {{.global.task.input.servername}}\r\n                }\r\n            4   {\r\n                Write-Host \"Adding CDP proxy\"\r\n                Add-VBRCDPProxy -Server {{.global.task.input.servername}}\r\n                }                \r\n            5   {\r\n                Write-Host \"Adding Computer proxy\"\r\n                Add-VBRComputerFileProxyServer -Server {{.global.task.input.servername}}\r\n                }\r\n           default {\r\n                Write-Host \"Proxy type not supported!\"\r\n                exit 1\r\n            }\r\n        }\r\n        exit 0 \r\n    }\r\n    else {\r\n        Write-Output \"Managed server not found!\"\r\n        exit 0\r\n    }\r\n}\r\ncatch {\r\n    Write-Output \"Exception in add proxy\"\r\n    exit 1\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n","ContentType":"json","Description":"Add VBR proxy ","Label":"Add VBR Proxy","Name":"InvokePowerShellScript1","ObjectType":"workflow.PowerShellApi","OperationTimeout":"300","Outcomes":[],"PowerShellResponseSpec":{"Parameters":[]}}],"CancelAction":[],"ClassId":"workflow.PowerShellBatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Name":"VBR - Add Proxy v1.0","ObjectType":"workflow.PowerShellBatchApiExecutor","Output":{},"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"VBR-AddProxyv1.0\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/PowerShellBatchApiExecutors","Verb":"POST"}]