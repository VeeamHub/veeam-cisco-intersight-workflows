[{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Label":"VBR - Credential Check v1.0","Name":"VBR-CredentialCheckv1.0","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"CustomDataTypeProperties":{"CatalogMoid":"shared","ObjectType":"workflow.CustomDataProperty"},"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The PowerShell endpoint on which the script is to be executed. PowerShell Remoting must be enabled on the endpoint to allow for scripts to be executed remotely.\n","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"Dropdown"},"Label":"External Target","Name":"Target","ObjectType":"workflow.TargetDataType","Properties":[{"DisplayAttributes":["Name","TargetType"],"ObjectType":"workflow.TargetProperty","Selector":"/api/v1/asset/Targets?$filter=(TargetType eq PowerShellEndpoint and Status eq Connected)","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"SupportedObjects":["asset.Target"]}],"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"User Credential Description","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"User Description","Name":"userdescription","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Administrative User","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"User Name","Name":"username","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Admin password","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Password","Name":"userpassword","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Secure":true,"Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Account Type","Name":"accounttype","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[{"Label":"Windows Credentials","ObjectType":"workflow.EnumEntry","Value":"Windows"},{"Label":"Linux Credentials","ObjectType":"workflow.EnumEntry","Value":"Linux"}],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"enum"},"Required":true}],"ObjectType":"workflow.Properties","OutputDefinition":[],"RetryDelay":60,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":60,"TimeoutPolicy":"Timeout"},"RollbackTasks":[],"SecurePropAccess":true,"SharedScope":"user","Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"Batch":[{"Body":"#\r\n# Search VBR managed credentials for a matching username / user description. If found return\r\n# true otherwise create a new set of credentials and return true if the credentials were \r\n# successfully created.\r\n#\r\n# Inputs: workflow inputs with referenced inputs \"username\", \"userdescription\", \"userpassword\"\r\n# and \"accounttype\" (0 - \"Windows\" default or 1 - \"Linux\")\r\n#\r\ntry {\r\n    $cred = Get-VBRCredentials | Where-Object {$_.Description -eq \"{{.global.task.input.userdescription}}\" -and $_.Name -eq \"{{.global.task.input.username}}\"}\r\n    if ($cred -EQ $null) {\r\n        if ({{.global.task.input.accounttype}} -EQ 1) {\r\n            $cred = Add-VBRCredentials -User \"{{.global.task.input.username}}\" -Password \"{{.global.task.input.userpassword}}\" -Description \"{{.global.task.input.userdescription}}\" -Type \"Linux\" -ElevateToRoot\r\n        }\r\n        else {\r\n            $cred = Add-VBRCredentials -User \"{{.global.task.input.username}}\" -Password \"{{.global.task.input.userpassword}}\" -Description \"{{.global.task.input.userdescription}}\" -Type \"Windows\"\r\n        }\r\n        if ($cred -EQ $null) { exit 1 }\r\n    }\r\n    exit 0\r\n}\r\ncatch { exit 1 }","ContentType":"json","Description":"Check for existence of credential.  If does not exist then add to VBR credential database.","Label":"VBR - Credential Check","Name":"InvokePowerShellScript1","ObjectType":"workflow.PowerShellApi","Outcomes":[],"PowerShellResponseSpec":{"Parameters":[]}}],"CancelAction":[],"ClassId":"workflow.PowerShellBatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Name":"VBR - Credential Check v1.0","ObjectType":"workflow.PowerShellBatchApiExecutor","Output":{},"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"VBR-CredentialCheckv1.0\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/PowerShellBatchApiExecutors","Verb":"POST"}]